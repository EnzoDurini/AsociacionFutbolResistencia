  <!DOCTYPE html>
  <html lang="es">
  
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="description" content="Futbol">
      <title>Asociación de Fútbol</title>
      <!--LINKS-->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
      <!--Fonts-->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Edu+NSW+ACT+Foundation&display=swap" rel="stylesheet">
      <!--CSS-->
      <link rel="stylesheet" href="/css/index.css">
  
  </head>
  
  <body>
      <div class="wrapper">
          <header class="container-fluid colornuevo">
              <nav class="navbar navbar-expand-lg transparent">
                  <div class="container-fluid">
                      <a href="./"><img src="/assets/logoHeader.jpg" alt="" class="bhn"></a>
                      <button class="navbar-toggler botoncabecera" type="button" data-bs-toggle="collapse"
                          data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false"
                          aria-label="Toggle navigation">
                          <span class="navbar-toggler-icon"></span>
                      </button>
  
                      <div class="collapse navbar-collapse cabecera" id="navbarNavDropdown">
                          <ul class="navbar-nav cabecera">
                              <li class="nav-item">
                                  <a class="nav-link cabecera he" href="./">Inicio</a>
                              </li>
                              <li class="nav-item">
                                  <a class="nav-link cabecera he" href="/inscripcion">Inscripción</a>
                              </li>
                              <li class="nav-item">
                                  <a class="nav-link cabecera he" href="/torneo">Torneo</a>
                              </li>
                              <li class="nav-item">
                                  <a class="nav-link cabecera he" href="/fixture">Fixture</a>
                              </li>
                              <li class="nav-item">
                                  <a class="nav-link cabecera he he2" href="/encuentros">Encuentros</a>
                              </li>
                              <li class="nav-item">
                                  <a class="nav-link cabecera he " href="/resultados">Resultados</a>
                              </li>
                          </ul>
                      </div>
                  </div>
              </nav>
          </header>
  
  
  
          <main>
            <h1>Detalles del Encuentro</h1>
            <h2>Partido: <%= encuentro.EquipoLocal %> vs <%= encuentro.EquipoVisitante %></h2>

            <!-- Tabla para jugadores del equipo local -->
            <h3>
                Equipo Local: <%= encuentro.EquipoLocal %>
                <button class="btn btn-danger btn-sm" onclick="marcarAusencia('<%= encuentro.EquipoLocalID %>', '<%= encuentro.IDPARTIDO %>')">
                    Se Ausentó
                </button>
            </h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Nro Socio</th>
                        <th>Jugador</th>
                        <th>Faltas</th>
                        <th>Goles</th>
                        <th>Amarillas</th>
                        <th>Expulsado</th>
                    </tr>
                </thead>
                <tbody>
                    <% jugadores.filter(j => j.Equipo === 'Local').forEach(jugador => { %>
                    <tr data-dnifk="<%= jugador.DNIFK %>">
                        <td><%= jugador.NROSOCIO %></td>
                        <td><%= jugador.Nombre %> <%= jugador.Apellido %></td>
                        <td><input type="number" class="form-control" id="faltas-<%= jugador.DNIFK %>" /></td>
                        <td><input type="number" class="form-control" id="goles-<%= jugador.DNIFK %>" /></td>
                        <td><input type="number" class="form-control" id="amarillas-<%= jugador.DNIFK %>" /></td>
                        <td>
                            <select class="form-control" id="expulsado-<%= jugador.DNIFK %>">
                                <option value="No">No</option>
                                <option value="Si">Sí</option>
                            </select>
                        </td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>

            <!-- Tabla para jugadores del equipo visitante -->
            <h3>
                Equipo Visitante: <%= encuentro.EquipoVisitante %>
                <button class="btn btn-danger btn-sm" onclick="marcarAusencia('<%= encuentro.EquipoVisitanteID %>', '<%= encuentro.IDPARTIDO %>')">
                    Se Ausentó
                </button>
            </h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Nro Socio</th>
                        <th>Jugador</th>
                        <th>Faltas</th>
                        <th>Goles</th>
                        <th>Amarillas</th>
                        <th>Expulsado</th>
                    </tr>
                </thead>
                <tbody>
                    <% jugadores.filter(j => j.Equipo === 'Visitante').forEach(jugador => { %>
                    <tr data-dnifk="<%= jugador.DNIFK %>">
                        <td><%= jugador.NROSOCIO %></td>
                        <td><%= jugador.Nombre %> <%= jugador.Apellido %></td>
                        <td><input type="number" class="form-control" id="faltas-<%= jugador.DNIFK %>" /></td>
                        <td><input type="number" class="form-control" id="goles-<%= jugador.DNIFK %>" /></td>
                        <td><input type="number" class="form-control" id="amarillas-<%= jugador.DNIFK %>" /></td>
                        <td>
                            <select class="form-control" id="expulsado-<%= jugador.DNIFK %>">
                                <option value="No">No</option>
                                <option value="Si">Sí</option>
                            </select>
                        </td>
                    </tr>
                    <% }); %>
                </tbody>
            </table>

            <button class="btn btn-primary btn-lg mt-3" onclick="guardarEstadisticas(<%= encuentro.IDPARTIDO %>)">
                Guardar Estadísticas
            </button>
        </main>
  
  
          <footer class="container-fluid">
              <div class="row">
                  <div class="col-lg-9 container-fluid">
                      <div class="row">
                          <h2 class="col-lg-3 mt-1">Contacto</h2>
                          <a class="col-lg-3 col-md-4 col-sm-12 footerText links" href="https://api.whatsapp.com/ target="
                              target="_blank"><i class="fa-brands fa-whatsapp"></i></a>
                          <a class="col-lg-3 col-md-4 col-sm-12 footerText links" href="https://www.instagram.com/"
                              target="_blank"><i class="fa-brands fa-instagram"></i></a>
                          <a class="col-lg-3 col-md-4 col-sm-12 footerText links" href="#" target="_blank"><i
                                  class="fa-regular fa-envelope"></i></a>
                      </div>
                  </div>
  
                  <div class="col-lg-3 col-md-12 col-sm-12 mt-1 container-fluid">
                      <div class="row">
                          <a class="footerText pp col-md-12 col-sm-12 col-lg-12" href="#">Politicas de Privacidad</a>
                          <a class="footerText ppo col-md-12 col-sm-12 col-lg-12"
                              href="https://miro.com/app/settings/team/3458764596483398883/profile"
                              target="_blank">Developed by Pablinka
                              Team</a>
                      </div>
                  </div>
              </div>
          </footer>
      </div>
      <!-- Mi Js -->
      <script src="/js/index.js"></script>
      <!-- bootstrap -->
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
          integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
          crossorigin="anonymous"></script>
      <!-- Fonts -->
      <script src="https://kit.fontawesome.com/026c9a0387.js" crossorigin="anonymous"></script>

      
<script>
    async function marcarAusencia(equipoId, partidoId) {
  try {
    const response = await fetch('/encuentro/ausencia', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ equipoId, partidoId })
    });

    if (response.ok) {
      alert('Ausencia marcada exitosamente.');
      location.reload();
    } else {
      const error = await response.text();
      alert(`Error: ${error}`);
    }
  } catch (err) {
    console.error('Error al marcar ausencia:', err);
    alert('Error interno al marcar ausencia.');
  }
}

async function guardarEstadisticas(idPartido) {
        const estadisticas = [];
        const mensajeCarga = document.getElementById('mensaje-carga');
       

        document.querySelectorAll("table tbody tr").forEach(row => {
            const dnifk = row.getAttribute('data-dnifk');
            const faltas = parseInt(row.querySelector(`#faltas-${dnifk}`).value) || 0;
            const goles = parseInt(row.querySelector(`#goles-${dnifk}`).value) || 0;
            const amarillas = parseInt(row.querySelector(`#amarillas-${dnifk}`).value) || 0;
            const expulsado = row.querySelector(`#expulsado-${dnifk}`).value === 'Si' ? 1 : 0;

            if (dnifk) { // Validación de datos
                estadisticas.push({ dnifk, faltas, goles, amarillas, expulsado });
            }
        });

        try {
            const response = await fetch('/encuentro/guardar', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ idPartido, estadisticas })
            });
    }

  </script>


  </body>
  
  </html>